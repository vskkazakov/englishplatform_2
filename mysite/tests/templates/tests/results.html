{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Entertaining English - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <link rel="stylesheet" href="{% static 'tests/styles.css' %}?v=2.1">
    <script src="{% static 'tests/mobile-nav.js' %}?v=1.0" defer></script>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <span class="logo-text">Entertaining</span><span class="logo-accent">English</span>
            </div>
            <div class="nav">
                <a href="{% url 'index' %}" class="nav-link">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                <a href="{% url 'dictionary:index' %}" class="nav-link">–°–ª–æ–≤–∞—Ä—å</a>
                <a href="{% url 'tests:index' %}" class="nav-link">–¢–µ—Å—Ç—ã</a>
                <a href="{% url 'act_static:index' %}" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="{% url 'games:index' %}" class="nav-link">–ò–≥—Ä—ã</a>
                {% if user.is_authenticated %}
                    <span class="user-greeting">–ü—Ä–∏–≤–µ—Ç, {{ user.first_name|default:user.username }}!</span>
                    <a href="{% url 'authen:logout' %}" class="btn-login">–í—ã–π—Ç–∏</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="results-card">
                <div class="results-header">
                    <h2>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                </div>
                <div class="results-body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="score-circle 
                                {% if success_rate >= 90 %}score-excellent
                                {% elif success_rate >= 70 %}score-good
                                {% elif success_rate >= 50 %}score-average
                                {% else %}score-poor{% endif %}">
                                {{ success_rate }}%
                            </div>
                            <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                        </div>
                        <div class="stat-item stat-correct">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-value">{{ test_session.correct_answers }}</div>
                            <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                        </div>
                        <div class="stat-item stat-incorrect">
                            <div class="stat-icon">‚ùå</div>
                            <div class="stat-value">{{ test_session.incorrect_answers }}</div>
                            <div class="stat-label">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                        </div>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">‚è±Ô∏è –í—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                            <div class="info-value">{{ duration }} –º–∏–Ω.</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                            <div class="info-value">{{ test_session.get_categories_display }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
            {% if category_stats %}
            <div class="results-card">
                <div class="results-header">
                    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
                </div>
                <div class="results-body">
                    <div class="category-stats">
                        {% for category, stats in category_stats.items %}
                        <div class="category-item">
                            <div class="category-header">
                                <div class="category-name">{{ category|title }}</div>
                                <div class="category-percentage">{{ stats.percentage }}%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill 
                                    {% if stats.percentage >= 80 %}progress-excellent
                                    {% elif stats.percentage >= 60 %}progress-good
                                    {% elif stats.percentage >= 40 %}progress-average
                                    {% else %}progress-poor{% endif %}" 
                                    style="width: {{ stats.percentage }}%">
                                </div>
                            </div>
                            <div class="answer-details">
                                –ü—Ä–∞–≤–∏–ª—å–Ω–æ: {{ stats.correct }}/{{ stats.total }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –î–µ—Ç–∞–ª–∏ –æ—Ç–≤–µ—Ç–æ–≤ -->
            {% if answer_details %}
            <div class="results-card">
                <div class="results-header">
                    <h2>üìù –î–µ—Ç–∞–ª–∏ –æ—Ç–≤–µ—Ç–æ–≤</h2>
                </div>
                <div class="results-body">
                    {% for answer in answer_details %}
                    <div class="answer-item {% if answer.is_correct %}answer-correct{% else %}answer-incorrect{% endif %}">
                        <div class="answer-word">
                            {{ answer.word.english_word }} - {{ answer.word.russian_translation }}
                        </div>
                        <div class="answer-details">
                            {% if answer.is_correct %}
                                ‚úÖ –í–∞—à –æ—Ç–≤–µ—Ç: {{ answer.user_answer }}
                            {% else %}
                                ‚ùå –í–∞—à –æ—Ç–≤–µ—Ç: {{ answer.user_answer }} | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: {{ answer.correct_answer }}
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
            <div class="actions">
                <a href="{% url 'tests:index' %}" class="btn btn-primary">
                    üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é —Ç–µ—Å—Ç–æ–≤
                </a>
                <a href="{% url 'tests:history' %}" class="btn btn-secondary">
                    üìä –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤
                </a>
                <a href="{% url 'dictionary:index' %}" class="btn btn-outline">
                    üìö –ö —Å–ª–æ–≤–∞—Ä—é
                </a>
            </div>
        </div>
    </main>
</body>
</html>

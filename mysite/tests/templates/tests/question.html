{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Entertaining English - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <link rel="stylesheet" href="{% static 'tests/styles.css' %}?v=2.1">
    <script src="{% static 'tests/mobile-nav.js' %}?v=1.0" defer></script>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <span class="logo-text">Entertaining</span><span class="logo-accent">English</span>
            </div>
            <div class="nav">
                <a href="{% url 'index' %}" class="nav-link">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                <a href="{% url 'dictionary:index' %}" class="nav-link">–°–ª–æ–≤–∞—Ä—å</a>
                <a href="{% url 'tests:index' %}" class="nav-link">–¢–µ—Å—Ç—ã</a>
                <a href="{% url 'act_static:index' %}" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="{% url 'games:index' %}" class="nav-link">–ò–≥—Ä—ã</a>
                {% if user.is_authenticated %}
                    <span class="user-greeting">–ü—Ä–∏–≤–µ—Ç, {{ user.first_name|default:user.username }}!</span>
                    <a href="{% url 'authen:logout' %}" class="btn-login">–í—ã–π—Ç–∏</a>
                {% endif %}
            </div>
        </div>
    </header>
    <main class="main">
        <div class="container">
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-text">–ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ—Å—Ç–∞</span>
                    <span class="progress-badge">{{ current_index }}/{{ total_words }}</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" style="width: {{ progress_percentage }}%"></div>
                </div>
            </div>

            {% if show_result %}
                <!-- –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                <div class="question-card {% if is_correct %}result-correct{% else %}result-incorrect{% endif %}">
                    <div class="question-header">
                        {% if is_correct %}
                            <div class="result-icon">‚úÖ</div>
                            <div class="result-title">–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ</div>
                        {% else %}
                            <div class="result-icon">‚ùå</div>
                            <div class="result-title">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ üòî</div>
                        {% endif %}
                    </div>
                    
                    <div class="result-details">
                        <div class="result-text"><strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong> {{ user_answer }}</div>
                        {% if not is_correct %}
                            <div class="result-text correct-answer"><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> {{ correct_answer }}</div>
                        {% endif %}
                    </div>

                    <div class="countdown">
                        –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É —á–µ—Ä–µ–∑ <span id="countdown">3</span> —Å–µ–∫—É–Ω–¥...
                    </div>
                </div>
            {% else %}
                <!-- –í–æ–ø—Ä–æ—Å -->
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-type">{{ question_type }}</div>
                        <div class="question-word">{{ question_word }}</div>
                        {% if question_hint %}
                            <div class="question-hint">{{ question_hint }}</div>
                        {% endif %}
                    </div>

                    <form method="post" id="answerForm" class="answer-form">
                        {% csrf_token %}
                        <input type="text" name="answer" class="answer-input" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." 
                               autocomplete="off" 
                               autofocus 
                               required>
                    </form>
                </div>
            {% endif %}
        </div>
    </main>

    <script>
        {% if show_result %}
        // –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
        let countdown = 3;
        const countdownElement = document.getElementById('countdown');
        
        const timer = setInterval(() => {
            countdown--;
            countdownElement.textContent = countdown;
            
            if (countdown <= 0) {
                clearInterval(timer);
                window.location.href = '{% url "tests:question" %}';
            }
        }, 1000);
        {% else %}
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –≤–≤–æ–¥–µ
        document.getElementById('answerForm').addEventListener('submit', function(e) {
            const input = document.querySelector('.answer-input');
            if (input.value.trim() === '') {
                e.preventDefault();
                input.focus();
            }
        });
        {% endif %}
    </script>
</body>
</html>
